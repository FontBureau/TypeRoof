var g=Object.defineProperty;var n=(s,e)=>g(s,"name",{value:e,configurable:!0});import{I as f,J as v,V as b,w as T,T as P,x as S,b as L,P as A,n as V,F as E,z as C,B as O,D as M,H as F,_ as l,O as w}from"./type-tools-grid-C_FRaIh_.js";const a=Symbol("LAYOUT_GROUP_DEFAULT"),c=Object.fromEntries([[a,{label:"TypeRoof Original"}]].map(([s,e],t)=>[s,Object.freeze(Object.assign({},e,{index:t}))]));Object.defineProperty(c,"default",{value:a,enumerable:!1});Object.freeze(c);const y=Object.freeze([["StageAndActors","Stage and Actors",v,a],["VideoproofArrayDev","Videoproof Array (Interim)",b,a],["VideoproofArray","Array",T,a],["TypeToolsGrid","Grid",P,a],["TypeSpecRamp","TypeSpec - Ramp",S,a]]);function u(s,e,t,...i){s.addEventListener(e,t,...i)}n(u,"_addListener");function h(s,e,t,...i){s.removeEventListener(e,t,...i)}n(h,"_removeListener");class z extends l{static{n(this,"UIVisibilityManager")}visibleClass="visible";constructor(e,t){super(e),this._isPlayingPath=t,this.node=e.wrapper.host,this._timeout=null,this._listenerPointermove=null,this._listenerPointerleave=null,this._mode=null;for(const i of["screengrab","no-chrome"])if(e.uiFlags.has(i)){this.setMode(i);break}this._mode===null&&this.setMode("default")}setMode(e){this._mode=e;const t=this.getEntry("/"),i=w(t,this._isPlayingPath,{value:!0}).value;this.setPlayingState(i)}_startListening(){this._listenerPointermove===null&&(this._listenerPointermove=[this.node,"pointermove",()=>this._addVisibilityAndTimeout()],u(...this._listenerPointermove),this._listenerPointerleave=[this.node,"pointerleave",()=>this._removeVisibilty()],u(...this._listenerPointerleave))}_stopListening(){this._listenerPointermove!==null&&(h(...this._listenerPointermove),this._listenerPointermove=null,h(...this._listenerPointerleave),this._listenerPointerleave=null)}_addVisibilityAndTimeout(e=1500){this._addVisibility(),this._cancelTimeout(),this._timeout=this._domTool.window.setTimeout(this._removeVisibilty.bind(this),e)}_cancelTimeout(){this._timeout!==null&&this._domTool.window.clearTimeout(this._timeout),this._timeout=null}_addVisibility(){this.node.classList.add(this.visibleClass)}_removeVisibilty(){this.node.classList.remove(this.visibleClass)}destroy(){this._cancelTimeout(),this._stopListening(),this._removeVisibilty(),super.destroy()}_toggleVisibilityAutomatic(e,t=!0){e?(this._startListening(),t?this._addVisibilityAndTimeout(0):this._removeVisibilty()):(this._cancelTimeout(),this._stopListening(),t?this._addVisibility():this._removeVisibilty())}setPlayingState(e){let t,i=!0;this._mode==="no-chrome"?(t=!1,i=!1):this._mode==="screengrab"?t=!0:t=e,this._toggleVisibilityAutomatic(t,i)}}class U extends l{static{n(this,"MonitorPlayingState")}constructor(e,t){super(e),this._onChange=t}update(e){if(e.has("playing")){const t=e.get("playing").value;this._onChange(t)}}}class D extends l{static{n(this,"ToggleFullscreen")}static TEMPLATE='<button class="ui_toggle_fullscreen">Toggle Fullscreen</button>';constructor(e,t){super(e),this._element=this._initTemplate(t)}_initTemplate(e){const t=this._domTool.createFragmentFromHTML(this.constructor.TEMPLATE).firstElementChild;return this._insertElement(t),t.addEventListener("click",()=>{if(document.fullscreenElement){document.exitFullscreen();return}e.requestFullscreen().catch(i=>{console.error(`${this} Error enabling fullscreen: ${i.message}`)})}),[t]}}class I extends L{static{n(this,"MainUIController")}constructor(e){const t=new Map([["main",".typeroof-ui_main"],["after-main",".typeroof-ui_main-after"],["before-layout",".typeroof-layout-before"],["layout",".typeroof-layout"],["after-layout",".typeroof-layout-after"],["wrapper","body .wrapper"]].map(([o,m])=>[o,e.domTool.document.querySelector(m)])),i=e.domTool.createElement("div",{class:"general-settings"}),d=e.domTool.createElement("div",{class:"application-meta"});t.set("general-settings",i),t.set("application-meta",d);const r=A.fromParts(".","activeState"),_=[[{zone:"wrapper",id:"visibility-manager"},[],z,r.append("playing")],[{rootPath:r,zone:"main",activationTest:n(()=>this.widgetBus.getEntry(r).has("playing"),"activationTest")},["playing"],U,function(o){this.widgetBus.getWidgetById("visibility-manager").setPlayingState(o)}],...y.map(([,,o])=>[{rootPath:r,zone:"main",activationTest:n(()=>this.widgetBus.getEntry(r).WrappedType===o.Model,"activationTest")},[],o.Controller,t]),[{zone:"main"},[],V,i],[{zone:"general-settings"},[["availableFonts","options"],"activeFontKey"],E],[{zone:"general-settings"},[],D,e.domTool.document.body],[{zone:"after-main"},[],C,"Application Meta",d],[{zone:"application-meta"},[["availableFonts"]],O,[[M,"Manage fonts"],[F,"Save / Load / Share"]]]];super(e,t,_)}get dependencies(){const e=super.dependencies;return e.add("/activeState"),e}get modelDependencies(){const e=super.modelDependencies;return e.add("/activeState"),e}}function p(){R.setInitialDependency("ready",!0)}n(p,"main");const R=new f(window,{MainUIController:I,Layouts:y,LAYOUT_GROUPS:c});document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p();
