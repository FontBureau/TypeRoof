<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>live/README - Documentation - TypeRoof</title>
        <meta name="viewport" content="initial-scale=1,shrink-to-fit=no">
        <link rel="stylesheet" href="../../lib/css/shell.css">
        <!-- for syntax highlighting https://www.11ty.dev/docs/plugins/syntaxhighlight/-->
        <link href="https://unpkg.com/prismjs@1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    </head>
    <body class="typeroof-docs">
        <div class="wrapper">
            <header>
                <h1>TypeRoof</h1>
            </header>
            <div class="typeroof-ui_sidebar">

                <h3>Content</h3>
                <nav>
                    <ul><li><a href="/TypeRoof/docs/">Landing Page</a><ul><li><a href="/TypeRoof/docs/usage/">User Kit</a></li>
<li><a href="/TypeRoof/docs/development/">Developer Kit</a><ul><li><a href="/TypeRoof/docs/development/live/">Live Font Updates</a></li>
<li class="active"><a href="/TypeRoof/live/README/">live/README</a></li>
<li><a href="/TypeRoof/docs/development/glyph-groups/">Extend Glyph-Groups</a></li></ul></li></ul></li>
<li><a href="/TypeRoof/docs/states_lib/">States Library</a><ul><li><a href="/TypeRoof/docs/states_lib/demos/">/demos</a></li></ul></li>
<li><a href="/TypeRoof/README/">Project README</a></li></ul>
                </nav>
                <h3>Applications</h3>
                <ul class="typeroof-ui_sidebar-app_links">
                    <li><a href="../../shell">TypeRoof Shell</a></li>
                    <li><a href="../../legacy">TypeRoof Legacy</a></li>
                </ul>
            </div>
            <div class="typeroof-main">
                <div class="typeroof-docs_content"><h1><a id="serve-live-font-changes-to-typeroof" class="heading_anchor" href="#serve-live-font-changes-to-typeroof" aria-hidden="true">#</a>Serve Live Font Changes to TypeRoof</h1>
<p>This is an example implementation to showcase how TypeRoof can live update
fonts that have changed e.g. within a font editor or on your hard-drive.
The idea is for font editors to pick this up and to provide the feature
built in for their users.</p>
<p>For font editor implementers or if you are interested in technical details,
see the technical documentation at: <a href="https://fontbureau.github.io/TypeRoof/docs/development/live">Developer Kit – Live font changes</a></p>
<p>If your font editor does not yet implement font updates in TypeRoof directly
or if you just want to try it out in another scenario you can use these
scripts to <strong>monitor fonts in a local folder/directory on your computer</strong> and
send update messages to TypeRoof, the <a href="#run-with-websocket">Run with WebSocket</a> example is better suited
for this case, as the polling example has cross-orign limitations and the
polling adapter reqiures a (hard-coded) list of known file names to poll.</p>
<h2><a id="install" class="heading_anchor" href="#install" aria-hidden="true">#</a>Install</h2>
<p>You need to do this only in order to use the <code>websocket-font-update-server.py</code>
and <code>file_rotation.py</code> scripts.</p>
<p>This installation procedure recommends to use a python virtual environment
in order to keep the system/user python installation unaffected.</p>
<pre class="language-sh-session"><code class="language-sh-session"><span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">Initialize a python virtual environmnet <span class="token keyword">in</span> the TypeRoof/live directory.</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">~/path/to/TypeRoof/live<span class="token operator">></span> python3 <span class="token parameter variable">-m</span> venv venv</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token punctuation">(</span>venv<span class="token punctuation">)</span>~/path/to/TypeRoof/live<span class="token operator">></span></span></span>

<span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">Activate the virtual environment.</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">~/path/to/TypeRoof/live<span class="token operator">></span> <span class="token builtin class-name">.</span> venv/bin/activate</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token punctuation">(</span>venv<span class="token punctuation">)</span>~/path/to/TypeRoof/live<span class="token operator">></span></span></span>

<span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">Install the dependencies into the virtual environment.</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token punctuation">(</span>venv<span class="token punctuation">)</span>~/path/to/TypeRoof/live<span class="token operator">></span> pip <span class="token function">install</span> <span class="token parameter variable">-r</span> requirements.txt</span></span></code></pre>
<h2><a id="adapters-usage" class="heading_anchor" href="#adapters-usage" aria-hidden="true">#</a>Adapters Usage</h2>
<p>In order to connect any source of font changes and TypeRoof we load a
web-page, called an <strong>Adapter,</strong> that in turn opens TypeRoof as a
pop-up or in an iframe. That relation enables the usage of the <code>window.postMessage</code>
API to send messages with font updates from the Adapter to TypeRoof.</p>
<p>For the <strong>pop-up/new tab versions</strong> At the first time you open an adapter pop-ups
will be blocked in your browser. You’ll have to <strong>allow pop-ups and then
reload the page of the adapter</strong> again to successfully establish the connection.</p>
<p>In the window of the adapter page you’ll also be able to observe the
currently provided fonts and how they change.</p>
<p>For the <strong>iframe versions</strong> these open an <code>&lt;iframe&gt;</code> and make it cover the
full document, theres’s no new window, the separation between the adapter
and the app is hidden.</p>
<h2><a id="run-with-websocket" class="heading_anchor" href="#run-with-websocket" aria-hidden="true">#</a>Run with WebSocket</h2>
<p>There are two or three individual steps involved:</p>
<ul>
<li><a href="#websocket-part-1-server">WebSocket Part 1: Server</a></li>
<li><a href="#websocket-part-2-adapter">WebSocket Part 2: Adapter</a></li>
<li>(optionally) <a href="#part-3-file-rotation">Part 3: File Rotation</a></li>
</ul>
<h3><a id="websocket-part-1-server" class="heading_anchor" href="#websocket-part-1-server" aria-hidden="true">#</a>WebSocket Part 1: Server</h3>
<p>This will start a WebSocket-server at <code>ws://localhost:8765/</code> where the
page <code>adapter-websocket-to-typeroof.html</code> (see  <a href="#websocket-part-2-adapter">Part 2</a>)
can connect to.</p>
<p>You’ll need a directory to observe for font-changes, to test this, go to
<a href="#part-3-file-rotation">Part 3: File Rotation</a> first and run the file
rotation which will create the <code>fonts</code> directory.</p>
<pre class="language-sh-session"><code class="language-sh-session"><span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">With the activated virtual environment.</span></span>

<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token punctuation">(</span>venv<span class="token punctuation">)</span>~/path/to/TypeRoof/live<span class="token operator">></span> ./websocket-font-update-server.py fonts/</span></span></code></pre>
<h3><a id="websocket-part-2-adapter" class="heading_anchor" href="#websocket-part-2-adapter" aria-hidden="true">#</a>WebSocket Part 2: Adapter</h3>
<p>See <a href="#adapters-usage">Adapters Usage</a>.</p>
<h4><a id="a-use-the-online-adapter" class="heading_anchor" href="#a-use-the-online-adapter" aria-hidden="true">#</a>A: Use the online Adapter</h4>
<p>The adapter is also online at our web site and since WebSockets don’t
require special cross-site allowance in the browser (the server is required
to check), the online adapter is able to connect to the server started
in <a href="#websocket-part-1-server">WebSocket Part 1: Server</a>.</p>
<ul>
<li>Open <a href="https://fontbureau.github.io/TypeRoof/live/adapter-websocket-to-typeroof-iframe/">https://fontbureau.github.io/TypeRoof/live/adapter-websocket-to-typeroof-iframe/</a>
in your browser (iframe version).</li>
<li>or open <a href="https://fontbureau.github.io/TypeRoof/live/adapter-websocket-to-typeroof/">https://fontbureau.github.io/TypeRoof/live/adapter-websocket-to-typeroof/</a>
in your browser (pop-up/new tab version).</li>
</ul>
<h4><a id="b-using-a-local-web-server" class="heading_anchor" href="#b-using-a-local-web-server" aria-hidden="true">#</a>B: Using a Local Web-Server</h4>
<p>Alternatively, you can start a simple web-server to deliver the file:</p>
<pre class="language-sh-session"><code class="language-sh-session"><span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">You don</span></span><span class="token output">'t need the virtual environment for this

</span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">~/path/to/TypeRoof/live<span class="token operator">></span> python3 <span class="token parameter variable">-m</span> http.server <span class="token number">8000</span></span></span>
<span class="token output">Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
</span></code></pre>
<ul>
<li>Open <a href="http://0.0.0.0:8000/adapter-websocket-to-typeroof-iframe.html">http://0.0.0.0:8000/adapter-websocket-to-typeroof-iframe.html</a>
in your browser (iframe version).</li>
<li>or open <a href="http://0.0.0.0:8000/adapter-websocket-to-typeroof.html">http://0.0.0.0:8000/adapter-websocket-to-typeroof.html</a>
in your browser (pop-up/new tab version).</li>
</ul>
<h2><a id="run-with-polling" class="heading_anchor" href="#run-with-polling" aria-hidden="true">#</a>Run with Polling</h2>
<p>There are two or three individual steps involved:</p>
<ul>
<li><a href="#polling-part-1-server">Polling Part 1: Server</a></li>
<li><a href="#polling-part-2-adapter">Polling Part 2: Adapter</a></li>
<li>(optionally) <a href="#part-3-file-rotation">Part 3: File Rotation</a></li>
</ul>
<h3><a id="polling-part-1-server" class="heading_anchor" href="#polling-part-1-server" aria-hidden="true">#</a>Polling Part 1: Server</h3>
<p>Start a simple web-server. NOTE: there are cross-origin restrictions involved
with this technique, which is why the adapter and the polling must come
from the same origin or the server would have to send <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">Cross-Origin Resource Sharing (CORS)</a>
headers.</p>
<pre class="language-sh-session"><code class="language-sh-session"><span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">You don</span></span><span class="token output">'t need the virtual environment for this

</span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">~/path/to/TypeRoof/live<span class="token operator">></span> python3 <span class="token parameter variable">-m</span> http.server <span class="token number">8000</span></span></span>
<span class="token output">Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
</span></code></pre>
<h3><a id="polling-part-2-adapter" class="heading_anchor" href="#polling-part-2-adapter" aria-hidden="true">#</a>Polling Part 2: Adapter</h3>
<p>See <a href="#adapters-usage">Adapters Usage</a>.</p>
<p>Since the web server is already started you only need to open <a href="http://0.0.0.0:8000/adapter-polling-to-typeroof.html">http://0.0.0.0:8000/adapter-polling-to-typeroof.html</a>
in your browser.</p>
<p>The main purpose of this adapter is to serve as an example, thus there
are some assumptions hard-coded into this adapter:</p>
<ul>
<li>The fonts are located at ‘<a href="http://0.0.0.0:8000/fonts/">http://0.0.0.0:8000/fonts/</a>’</li>
<li>Looking for one font only called <code>live-font.ttf</code></li>
</ul>
<p>You can change these assumptions in the JavaScript of the adapter, but
for general usage the <a href="#run-with-websocket">Run with WebSocket</a> example
might be working out of the box.</p>
<p>See <a href="#adapters-usage">All Adapters Usage</a>.</p>
<h2><a id="part-3-file-rotation" class="heading_anchor" href="#part-3-file-rotation" aria-hidden="true">#</a>Part 3: File Rotation</h2>
<p>This is optional as a demo. To observe file changes created e.g. by a
font-editor, Part 1 and Part 2 are  sufficient.</p>
<p>If you don’t have a source directory for a changing font file that you want
to see updated in TypeRoof, i.e. a font updated by an editor or build process,
this script can “rotate” all font files from a source directory into a single
file in a target directory and thus trigger file-change events.</p>
<pre class="language-sh-session"><code class="language-sh-session"><span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">With the activated virtual environment.</span></span>

<span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">Rotate the files <span class="token keyword">in</span> <span class="token string">"../lib/assets/fonts/*"</span> as <span class="token string">"live-font.ttf"</span> <span class="token keyword">in</span> <span class="token string">"the"</span></span></span>
<span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">./fonts directory every two seconds. NOTE especially the <span class="token variable"><span class="token variable">`</span><span class="token parameter variable">-f</span><span class="token variable">`</span></span> flag</span></span>
<span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">that is meant as safeguard to prevent accidental change to essential</span></span>
<span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">data.</span></span>
<span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token punctuation">(</span>venv<span class="token punctuation">)</span>~/path/to/TypeRoof/live<span class="token operator">></span> ./file_rotation.py <span class="token parameter variable">-f</span> <span class="token parameter variable">-s</span> <span class="token number">2</span> <span class="token parameter variable">-t</span> live-font.ttf ./fonts/ <span class="token punctuation">..</span>/lib/assets/fonts/*</span></span>

<span class="token command"><span class="token shell-symbol important">#</span> <span class="token bash language-bash">There</span></span><span class="token output">'s an online help in the tool:
</span><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token punctuation">(</span>venv<span class="token punctuation">)</span>~/path/to/TypeRoof/live<span class="token operator">></span>  ./file_rotation.py</span></span>
<span class="token output">usage: file_rotation.py [-h] [-t TARGET_FILE_NAME] [-f] [-s SECONDS] target_dir source_files [source_files ...]

Rotate font files between target dir and the source directories.

positional arguments:
  target_dir            Target directory name, will be created. Use --force if it exist and its contents can be overridden.
  source_files          Paths to each source files. Each file path will function as a source for the contents in target dir in rotation.

options:
  -h, --help            show this help message and exit
  -t TARGET_FILE_NAME, --target-file TARGET_FILE_NAME
                        Target file name, must not contain the slash character"/" (default: SampleFont.ttf)
  -f, --force           If target_dir exists, allow to change its contents.
  -s SECONDS, --seconds SECONDS
                        number of seconds between rotations (default: 7)
</span></code></pre>
</div>
            </div>
            <footer>
                <ul>
                    <li><a href="https://github.com/FontBureau/TypeRoof">Source code on GitHub</a></li><!--
                    --><li><a href="https://github.com/FontBureau/TypeRoof/issues">Bug reports &amp; feature&nbsp;requests</a></li>
                </ul>
            </footer>
        </div> <!-- wrapper -->
    </body>
</html>
